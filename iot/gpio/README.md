Copied with modifications from: https://github.com/ktgpio/ktgpio
